const asyncHandler = require("express-async-handler");
const db = require("../db/queries.js");

exports.get = [
  (req, res, next) => {
    if (!req.session.isGuest && !req.user) {
      res.render("index", { pageTitle: process.env.TITLE });
      return;
    }

    next();
  },
  asyncHandler(async (req, res) => {
    const isMember = req?.user?.is_member != null;
    const allMessages = await db.read.allMessages(isMember);

    res.render("index", {
      pageTitle: process.env.TITLE,
      messagesArray: allMessages,
    });
  }),
];
